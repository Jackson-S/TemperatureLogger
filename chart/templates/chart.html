<!DOCTYPE html>
<meta charset="UTF-8">

<head>
    <title>Temperature/Humidity Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>
        var labels = {{ labels | tojson }};
        var values = {{ values | tojson }};
        var devices = {{ devices | tojson }};
        var datatype = {{ datatype | tojson }};
        var timeframes = [{"name": "Day", "value": 24}, {"name": "Week", "value": 144}, {"name": "Month", "value": 24 * 30}, {"name": "Year", "value": 24 * 365}];
        var datatypes = {"temperature": "Temperature (C)", "humidity": "Humidity (%)", "pressure": "Pressure (HpA)"};
    </script>
    <style>
        #page {
            width: 100%;
        }

        #header {
            display: inline-flex;
        }

        #header > * {
            margin: 0;
            padding-right: 5px;
        }
    </style>
</head>

<body>
    <div id="page">
        <div id="header" style="display:inline-flex;"></div>
        <canvas id="chart"></canvas>
    </div>

    <script>
        function add_parameter(key, value) {
            var searchParams = new URLSearchParams(window.location.search);
            searchParams.set(key, value);
            window.location.search = searchParams.toString();
        }

        function setup_page() {
            var header = document.getElementById("header");
            
            // Add all timeframes to the top
            for (var i = 0; i < devices.length; i++) {
                var linkNode = document.createElement("a");
                linkNode.onclick = add_parameter("device", timeframes[i].value);
                linkNode.href = "#";
                linkNode.innerText =  timeframes[i].name;
                header.appendChild(linkNode);
            }

            // Add all devices available to the top
            for (var i = 0; i < devices.length; i++) {
                var linkNode = document.createElement("a");
                linkNode.onclick = add_parameter("timeframe", devices[i]);
                linkNode.href = "#";
                linkNode.innerText = devices[i];
                header.appendChild(linkNode);
            }
        }

        function setup_chart() {
            var ctx = document.getElementById('chart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: datatypes[datatype],
                        borderColor: '#7CE0F9B0',
                        backgroundColor: '#7CE0F990',
                        data: values
                    }],
                },
                options: {
                    scales: {
                        yAxes: [{
                            id: 'A',
                            type: 'linear',
                            position: 'left',
                        }]
                    }
                }
            });
        }

        setup_page();
        setup_chart();
    </script>
</body>